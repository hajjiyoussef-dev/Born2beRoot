-- General instructions --

	- signature.txt : 

		shasum x1.vdi : Secure Hashing Algorithm

			327f81b50db219000124b85cd92a0121e59c0c7f

	- diff : compare two files line by line

		diff x1 x2

-- Project overview --

	- How a virtual machine works :

		Virtual machines create virtual computer (guest) on a physical machine (host).
		It is created and managed by a hypervisor which allocates resources like CPU, memory, and storage to the VM,

	- Their choice of operating system :
		
		The Debian Project is a Community
		Debian is the Base for many other Distributions
		Huge Number of Software Packages
		Debian is easy to install

	- The basic differences between Rocky and Debian :
		
		Debian for General users and Excellent for desktop and server
		Rocky for Enterprise users and Limited (primarily server use)
		
	- The purpose of virtual machines

		run multiple operating systems (os) at the same time, from the same hardware without impacting the host operating system 
		optimizing resource usage and enhancing security
		
	- the difference between aptitude and apt

		Apt offers a command-line interface, while aptitude offers a visual interface
		When facing a package conflict, `apt` will not fix the issue while `aptitude` 
		will suggest a resolution that can do the job

	- what APPArmor is
		
		AppArmor is an security system application.
		works by applying predefined security profiles to applications, 
		restricting their access to system resources to enhance security

		sudo aa-status

-- Simple setup -- 

	- password policy
	
		sudo vim /etc/login.defs
		sudo vim /etc/security/pwquality.conf
		
	- connect with a user 
		
		ssh user@127.0.0.1 -p 4242

	- Check that the UFW service is started
		
		systemctl status ufw

	- Check that the SSH service is started

		systemctl status ssh

	- Check that the chosen operating system is Debian
		
		cat /etc/os-release

-- User -- 

	- Check that the user has been added and that it belongs to the "sudo" and "user42" groups
		
		whoami
		groups

	- the password policy have been put in place
		
		sudo vim /etc/security/pwquality.conf
		sudo vim /etc/login.defs
		sudo chage -l user
		sudo chage -M 90  -m 30 -W 7user

	- create a new user

		sudo adduser user
	
	- create a group named "evaluating" 
		
		sudo addgroup evaluating

	- assign it to this user
		
		sudo usermod -aG evaluation user

	- check that this user belongs to the "evaluating" group

		cat /etc/group
	
	- advantages and disadvantages of  password policy
		
		a complex password can be difficult to crack if the number of possible combinations is extremely high
		but it can also be too complex to be useful to users

		
-- Hostname and partitions --

	- hostname
		
		hostname
		
	- Modify this hostname
		
		sudo hostnamectl set-hostname newhostname
	
	- how to view the partitions for this virtual machine

		lsblk

	- how LVM works
		
		LVM (Logical Volume Manager) is a Linux disk management system that allows flexible partitioning, 
		resizing, and management of storage volumes across physical disks.

		PV -> VG -> LV which we create filesystems like ext4
		Physical volumes -> Volume groups -> Logical volumes which we create filesystems like ext4

		EXT4 (Fourth Extended File System) is a widely used, high-performance file system for Linux, 
		offering features like journaling, large file support, and improved reliability

		EXT4 is the best choice for Linux systems due to its performance, reliability, and advanced features.

		NTFS is the go-to for Windows, offering advanced features and compatibility with large files and partitions.

		FAT32 is a simple and universally compatible file system, but with significant limitations, 
		especially for large files and modern usage scenarios.


-- SUDO -- 

	- su vs sudo
		
		Use su when you need to fully switch to the root use

		Use sudo for executing individual commands with elevated privileges without switching users.

	- Check that the "sudo" program is properly installed
		
		apt list sudo

	-  assigning user to the "sudo" group.

		sudo usermod -aG sudo user

	- The subject imposes strict rules for sudo
		
		sudo vim /etc/sudoers

		passwd_tries=3: Limits password attempts to 3.
		badpass_message="Try again": Customizes the message shown when a user fails to enter the correct password.
		logfile="/var/log/sudo/sudo.log": Logs sudo activity to a specific file.
		log_input: Logs input entered by the user during sudo commands.
		log_output: Logs output from commands run with sudo.
		requiretty: Ensures sudo commands are executed from an interactive terminal, blocking non-interactive uses.
		Defaults secure_path : When you run a command with sudo, the PATH is set to this secure path, 
		meaning only these directories are searched for executables

	- explain the value and operation of sudo using examples 

		sudo allows a regular user to execute commands with superuser (root) privileges, 
		enabling administrative tasks without switching users. For example, 
		sudo apt install curl installs software by granting temporary root access

	- Verify that the "/var/log/sudo/" folder exists and has at least one file

		cd /var/log/sudo/
		vim sudo.log

-- UFW --

	- firewall
	
		A firewall is a security system that controls 
		incoming and outgoing network traffic		
	
	- Check that the "UFW" is properly installed
		
		apt list ufw

	- Check that it is working properl

		systemctl status ufw

	- what UFW is and the value of using it
		
		UFW (Uncomplicated Firewall) is a command-line tool, used to manage firewall rules	
	
	- List the active rules in UFW . A rule must exist for port 4242

		sudo ufw status numbered
	
	- Add a new rule to open port 8080

		sudo ufw allow 8080
		sudo ufw status numbered

	- delete this new rule 

		sudo ufw delete 2 and 3

-- SSH --

	- Check that the SSH service is properly installed

		apt list ssh

	- Check that it is working properly

		systemctl status ssh

	- what SSH is and the value of using it
		
		SSH (Secure Shell) is a cryptographic network protocol used to securely 
		access and manage remote computers over an insecure network
		
		- Password-based Authentication: The client provides a username and password, 
		which the server checks to grant access

		- Key-based Authentication :  Authentication Process:
			The client attempts to connect to the server via SSH.
			The server sends a challenge (a random number or message) to the client.
			The client uses its private key to sign the challenge and sends the signed message back to the server.
			The server uses the stored public key to verify the signature.
			If the signature matches, the server grants access, since it knows the client has the corresponding private key.

	- Verify that the SSH service only uses port 4242
		
		vim /etc/ssh/sshd_config

	- log in with the newly created user. 

		ssh user@127.0.0.1 -p 4242

-- Script monitoring --

	- How the script works

		cd  /root
		vim script.sh

	- What "cron" is

		Cron is a tool (or daemon) in Unix-like operating systems that manages 
		the scheduling and execution of tasks or commands at specified times

		* * * * * command_to_execute
		| | | | |
		| | | | +---- Day of the week (0 - 6) (Sunday = 0)
		| | | +------ Month (1 - 12)
		| | +-------- Day of the month (1 - 31)
		| +---------- Hour (0 - 23)
		+------------ Minute (0 - 59)


	- ensure that this script runs every minute.

		crontab -e

		*/10 * * * * wall /root/script.sh

-- Bonus --

	- disk 
	
		lsblk

	- wp

		username : admin
		pass : v5I@5ZjiIYzt(A$jsL

	-nodejs
		
		npm run dev

-- MORE --

- /home : home directory. It is the default current directory.
- /tmp : temporary space, typically cleared on reboot.
- /var : log files.
- /var/log : contains logs from the OS itself, services, and various applications running on the system
- /boot : It contains all the boot-related information files and folders such as conf, grub, etc.
- /srv : It contains server-specific and server-related files.
- [SWAP] :offering virtual memory that helps maintain system stability and performance
	Swap is a memory management technique that uses disk space to simulate additional RAM when physical memory is full
- /root : a secure and centralized location for the root user to store personal files

- tcp : TCP is a connection protocol that ensures data is delivered in order
		1 - SYN: The client sends a SYN (synchronize) packet to the server to initiate the connection.
		2 - SYN-ACK: The server responds with a SYN-ACK (synchronize-acknowledge) packet, confirming the client's request.
		3 - ACK: The client sends an ACK (acknowledge) packet back to the server, confirming the server's response.
		4 - After these steps, the connection is established, and data transmission can begin

- NAT (Network Address Translation) allows multiple devices on a local network 
	to share a single public IP address by translating private 
	IP addresses to a public one for internet communication.
	We use NAT (Network Address Translation) in virtual machines to 
	allow them to share the host system's public IP address, 
	enabling internet access while keeping the virtual machines' 
	private IP addresses hidden from external networks for security and ease of configuration

- IP address is a unique identifier for a device on a network

- port is a communication endpoint for services on that device

- IP:port refers to a specific service running on a device's IP address

- localhost is a special hostname referring to the local machine
	used for accessing services running on the same device

- TTY (Teletypewriter) refers to a terminal interface in Unix-like systems used for text-based communication
	works by providing a communication interface between the user and the operating system
	Using TTY is particularly useful for recovering from situations where the graphical environment is unresponsive, 
	such as due to a display driver issue, system crash, or other GUI-related failures.

- GRUB works by loading and passing control to the operating system's kernel during system startup, 
	allowing users to select between multiple boot options or operating systems from a menu.

- The kernel is the core part of an operating system that manages hardware resources, 
	enables communication between hardware and software

- When the power button is pressed, the BIOS/UEFI runs a self-test, loads the GRUB bootloader, 
	which then loads the Linux kernel, and the kernel initializes the system, 
	starting essential services and finally presenting a login prompt

- Disk: A physical storage device (HDD or SSD) used to store data.

- Partition: A logical division of a disk that creates separate sections 
	for organizing data or operating systems.

- Crypt: A storage area that has been encrypted to protect data, 
	requiring a key to access the content.

- LVM (Logical Volume Manager): A system for managing disk partitions flexibly, 
	allowing the creation, resizing, and management of logical volumes.

- ROM (Read-Only Memory): Non-volatile memory that stores data permanently, 
	typically used for firmware and system boot instructions.

- Primary Partition: A top-level partition that can directly hold an operating system or file system. 
	A disk can have up to four primary partitions (or three primary and one extended partition).

- Logical Partition: A partition created within an extended partition to overcome the 4-partition limit,
	 used for additional file systems or operating systems. There can be multiple logical partitions within one extended partition.

- Architecture=$(uname -a)

Architecture: Variable to store the system architecture information.
uname -a: Command that returns information about the system, including kernel version, hostname, and architecture.
The result is assigned to the Architecture variable.
CPUphysical=$(cat /proc/cpuinfo | grep 'physical id' | wc -l)

CPUphysical: Variable to store the number of physical CPU cores.
cat /proc/cpuinfo: Displays information about the CPU(s).
grep 'physical id': Filters the output for lines that contain 'physical id', which indicates a physical CPU.
wc -l: Counts the number of lines, which corresponds to the number of physical CPUs.
The result is stored in the CPUphysical variable.

- vCPU=$(nproc)

vCPU: Variable to store the number of virtual CPUs (logical processors).
nproc: Command that returns the number of processing units available to the system.
MemoryUsage=$(free -m | grep Mem | awk '{print $3 "/" $2"MB" " " "(" substr($3*100/$2, 0, 5) "%" ")" }')

MemoryUsage: Variable to store memory usage statistics.
free -m: Command to display memory usage in megabytes.
grep Mem: Filters the output to only show memory information.
awk '{print $3 "/" $2"MB" " " "(" substr($3*100/$2, 0, 5) "%" ")" }': Formats the output to show used memory ($3), total memory ($2), and usage percentage, rounded to 5 decimal places.

- DiskUsage=$(df -h --total | tail -n 1 | awk '{print substr($3,0,3) * 1000 "/" $2"b" " " "("$5")"}')

DiskUsage: Variable to store disk usage statistics.
df -h --total: Command that shows disk space usage in a human-readable format, including total disk usage.
tail -n 1: Selects the last line, which corresponds to total disk usage.
awk '{print substr($3,0,3) * 1000 "/" $2"b" " " "("$5")"}': Formats the output to show the used disk space (converted to kilobytes), the total disk space, and the percentage of disk usage.

- CPUload=$(vmstat | tail -n 1 | awk '{print 100 - $15 "%"}')

CPUload: Variable to store the CPU load percentage.
vmstat: Command that provides system performance statistics, including CPU load.
tail -n 1: Selects the last line of output.
awk '{print 100 - $15 "%"}': Computes the CPU idle percentage ($15), subtracts it from 100 to get the load percentage, and formats it as a percentage.

- Lastboot=$(uptime -s | awk '{print $1 " " substr($2, 0, 5)}')

Lastboot: Variable to store the system’s last boot time.
uptime -s: Command that returns the system's last boot time.
awk '{print $1 " " substr($2, 0, 5)}': Formats the output to show the date and the time of boot, truncating the time to the first 5 characters (HH:MM).

- LVMuse=$(lsblk | grep lvm | wc -l)

LVMuse: Variable to store whether LVM (Logical Volume Management) is in use.
lsblk: Command that lists information about block devices.
grep lvm: Filters the output for devices that are using LVM.
wc -l: Counts the number of lines that mention LVM (if any).
The result is the count of LVM devices.

- LVMuse=$([ $LVMuse > 0 ] && echo yes || echo no)

Reassigns the value of LVMuse based on the previous result.
[ $LVMuse > 0 ]: Checks if LVM is in use (i.e., the count is greater than 0).
&& echo yes: If LVM is in use, it sets LVMuse to yes.
|| echo no: If LVM is not in use, it sets LVMuse to no.

- ConnectionsTCP=$(ss -t | grep ESTAB | wc -l)

ConnectionsTCP: Variable to store the number of established TCP connections.
ss -t: Command that shows socket statistics, filtered to show TCP connections.
grep ESTAB: Filters the output for connections that are in the ESTABLISHED state.
wc -l: Counts the number of established connections.

- Userlog=$(who | wc -l)

Userlog: Variable to store the number of logged-in users.
who: Command that displays who is logged into the system.
wc -l: Counts the number of logged-in users.

- IP=$(ip addr | grep global | awk '{print substr($2, 0, 9)}')

IP: Variable to store the system's IP address.
ip addr: Command that shows the system's network interfaces.
grep global: Filters the output for global (IPv4) addresses.
awk '{print substr($2, 0, 9)}': Extracts the first 9 characters of the IP address (typically the first part of an IPv4 address).

- MAC=$(ip addr | grep link/ether | awk '{print $2}')

MAC: Variable to store the MAC address.
ip addr: Command to display network interface information.
grep link/ether: Filters for the MAC address lines.
awk '{print $2}': Extracts the MAC address.

- Sudo=$(cat /var/log/sudo/sudo.log | grep sudo | wc -l)

Sudo: Variable to store the number of sudo commands executed.
cat /var/log/sudo/sudo.log: Displays the contents of the sudo log.
grep sudo: Filters for lines containing the word sudo.
wc -l: Counts the number of times sudo appears, which indicates the number of sudo commands executed.

